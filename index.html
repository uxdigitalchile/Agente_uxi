<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte de conversaciones con Uxi</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: 
                radial-gradient(circle at 20% 50%, rgba(59, 130, 246, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(99, 102, 241, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 40% 80%, rgba(14, 165, 233, 0.1) 0%, transparent 45%),
                linear-gradient(135deg, #0a1628 0%, #1a237e 50%, #0d47a1 100%);
            min-height: 100vh;
            padding: 20px;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 25% 25%, rgba(59, 130, 246, 0.4) 1px, transparent 1px),
                radial-gradient(circle at 75% 75%, rgba(99, 102, 241, 0.3) 1px, transparent 1px),
                radial-gradient(circle at 50% 50%, rgba(14, 165, 233, 0.2) 1px, transparent 1px);
            background-size: 60px 60px, 80px 80px, 100px 100px;
            pointer-events: none;
            z-index: 0;
        }

        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(90deg, transparent 49.5%, rgba(59, 130, 246, 0.03) 50%, transparent 50.5%),
                linear-gradient(0deg, transparent 49.5%, rgba(59, 130, 246, 0.03) 50%, transparent 50.5%);
            background-size: 100px 100px;
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .header .logo-container img {
            height: 50px;
            width: auto;
        }

        .header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .config-panel {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .config-panel h3 {
            margin-bottom: 15px;
            color: #1a237e;
        }

        .input-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 5px;
            color: #333;
        }

        .input-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .input-group input:focus {
            outline: none;
            border-color: #1a237e;
        }

        .btn {
            background: linear-gradient(135deg, #1a237e 0%, #0d47a1 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            text-align: center;
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card .number {
            font-size: 3em;
            font-weight: bold;
            color: #1a237e;
            margin-bottom: 10px;
        }

        .stat-card .label {
            font-size: 1.1em;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }

        .chart-card h3 {
            margin-bottom: 20px;
            color: #333;
            text-align: center;
        }

        .table-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            overflow-x: auto;
        }

        .table-card h3 {
            margin-bottom: 20px;
            color: #333;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: linear-gradient(135deg, #1a237e 0%, #0d47a1 100%);
            color: white;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        tbody tr:hover {
            background: #f5f5f5;
        }

        .message-preview {
            max-width: 300px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .status.connected {
            background: #4caf50;
            color: white;
        }

        .status.disconnected {
            background: #f44336;
            color: white;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: white;
            font-size: 1.2em;
        }

        .error {
            background: #f44336;
            color: white;
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
        }

        .success {
            background: #4caf50;
            color: white;
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
        }

        .filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filters select, .filters input {
            padding: 8px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
        }

        .refresh-btn {
            background: #4caf50;
            margin-left: auto;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
        }

        .pagination .btn {
            padding: 8px 20px;
            font-size: 14px;
        }

        .pagination .btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        #page-info {
            color: #333;
        }

        /* üì± RESPONSIVE DESIGN - Mobile & Tablet */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .header h1 {
                font-size: 1.6em;
            }

            .header .logo-container img {
                height: 40px;
            }

            .config-panel, .stat-card, .chart-card, .table-card {
                padding: 15px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .stat-card .number {
                font-size: 2em;
            }

            .stat-card .label {
                font-size: 0.85em;
            }

            .charts-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .filters {
                flex-direction: column;
            }

            .filters select, .filters input, .filters button {
                width: 100%;
            }

            .btn {
                width: 100%;
                padding: 14px 20px;
                font-size: 15px;
            }

            .pagination {
                flex-direction: column;
                gap: 10px;
            }

            .pagination button {
                width: 100%;
            }

            table {
                font-size: 13px;
            }

            th, td {
                padding: 8px 4px;
            }

            .message-preview {
                max-width: 150px;
            }

            .table-card {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.3em;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .stat-card .number {
                font-size: 1.8em;
            }

            table {
                font-size: 11px;
            }

            th, td {
                padding: 6px 3px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><img src="data:image/png;base64,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" alt="Uxi" style="height: 60px; vertical-align: middle; margin-right: 15px;"> Reporte de conversaciones con Uxi</h1>
            <p>An√°lisis de conversaciones en tiempo real - Portal UXDigital</p>
            <div id="connection-status"></div>
        </div>

        <div class="config-panel">
            <h3>üîß Configuraci√≥n de Supabase</h3>
            <div class="input-group">
                <div>
                    <label for="supabase-url">Supabase URL:</label>
                    <input type="text" id="supabase-url" placeholder="https://tu-proyecto.supabase.co" value="https://xycaebocoeuwbhygjhjn.supabase.co">
                </div>
                <div>
                    <label for="supabase-key">Supabase Anon Key:</label>
                    <input type="password" id="supabase-key" placeholder="Tu clave anon p√∫blica">
                </div>
            </div>
            <button class="btn" onclick="connectSupabase()">üîå Conectar y Cargar Datos</button>
        </div>

        <div id="dashboard-content" style="display: none;">
            <div class="filters">
                <select id="period-filter" onchange="loadData()">
                    <option value="all">Todos los registros</option>
                    <option value="today">Hoy</option>
                    <option value="week">√öltima semana</option>
                    <option value="month">√öltimo mes</option>
                </select>
                <input type="date" id="date-from" onchange="loadData()">
                <input type="date" id="date-to" onchange="loadData()">
                <button class="btn refresh-btn" onclick="loadData()">üîÑ Actualizar</button>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="number" id="total-conversations">0</div>
                    <div class="label">Total Conversaciones</div>
                </div>
                <div class="stat-card">
                    <div class="number" id="total-sessions">0</div>
                    <div class="label">Sesiones √önicas</div>
                </div>
                <div class="stat-card">
                    <div class="number" id="avg-rating">-</div>
                    <div class="label">Rating Promedio</div>
                </div>
                <div class="stat-card">
                    <div class="number" id="total-ratings">0</div>
                    <div class="label">Calificaciones</div>
                </div>
            </div>

            <div class="charts-grid">
                <div class="chart-card">
                    <h3>üìà Conversaciones por D√≠a</h3>
                    <canvas id="dailyChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>‚≠ê Distribuci√≥n de Calificaciones</h3>
                    <canvas id="ratingsChart"></canvas>
                </div>
            </div>

            <div class="charts-grid">
                <div class="chart-card">
                    <h3>üïê Conversaciones por Hora</h3>
                    <canvas id="hourlyChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>üìä Calificaciones por D√≠a</h3>
                    <canvas id="ratingsTimeChart"></canvas>
                </div>
            </div>

            <div class="chart-card" style="margin-bottom: 30px;">
                <h3>üìä Top 10 Sesiones m√°s Activas</h3>
                <canvas id="sessionsChart"></canvas>
            </div>

            <div class="table-card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="margin: 0;">üí¨ √öltimas Conversaciones</h3>
                    <button class="btn" onclick="downloadCSV()" style="padding: 8px 20px; font-size: 14px;">
                        üì• Descargar Todas (CSV)
                    </button>
                </div>
                <table id="conversations-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Email</th>
                            <th>Fecha y Hora (Chile)</th>
                            <th>Mensaje</th>
                            <th>Rating</th>
                        </tr>
                    </thead>
                    <tbody id="table-body">
                    </tbody>
                </table>
                <div class="pagination">
                    <button class="btn" onclick="previousPage()" id="prev-btn">‚¨ÖÔ∏è Anterior</button>
                    <span id="page-info" style="margin: 0 20px; font-weight: 600;">P√°gina 1</span>
                    <button class="btn" onclick="nextPage()" id="next-btn">Siguiente ‚û°Ô∏è</button>
                </div>
            </div>
        </div>

        <div id="loading" class="loading" style="display: none;">
            ‚è≥ Cargando datos...
        </div>

        <div id="message" style="display: none;"></div>
    </div>

    <script>
        let supabaseUrl;
        let supabaseKey;
        let allData = [];
        let charts = {};
        let currentPage = 1;
        const rowsPerPage = 25;

        function showStatus(message, isError = false) {
            const statusDiv = document.getElementById('connection-status');
            statusDiv.innerHTML = `<span class="status ${isError ? 'disconnected' : 'connected'}">${message}</span>`;
        }

        function showMessage(message, isError = false) {
            const messageDiv = document.getElementById('message');
            messageDiv.className = isError ? 'error' : 'success';
            messageDiv.innerHTML = message;
            messageDiv.style.display = 'block';
            
            if (!isError) {
                setTimeout(() => {
                    messageDiv.style.display = 'none';
                }, 5000);
            }
        }

        async function fetchSupabase(endpoint, options = {}) {
            const url = `${supabaseUrl}/rest/v1/${endpoint}`;
            
            const headers = {
                'apikey': supabaseKey,
                'Authorization': `Bearer ${supabaseKey}`,
                'Content-Type': 'application/json',
                'Prefer': 'return=representation'
            };

            const response = await fetch(url, {
                ...options,
                headers: { ...headers, ...options.headers }
            });

            if (!response.ok) {
                const error = await response.text();
                throw new Error(`HTTP ${response.status}: ${error}`);
            }

            return response.json();
        }

        async function connectSupabase() {
            supabaseUrl = document.getElementById('supabase-url').value.trim();
            supabaseKey = document.getElementById('supabase-key').value.trim();

            if (!supabaseUrl || !supabaseKey) {
                showMessage('Por favor ingresa la URL y la clave de Supabase', true);
                return;
            }

            // Asegurar que la URL tenga el protocolo correcto
            if (!supabaseUrl.startsWith('http://') && !supabaseUrl.startsWith('https://')) {
                supabaseUrl = 'https://' + supabaseUrl;
                document.getElementById('supabase-url').value = supabaseUrl;
            }

            try {
                showStatus('Conectando...', false);
                document.getElementById('message').style.display = 'none';
                
                console.log('Probando conexi√≥n a:', supabaseUrl);
                
                // Test connection
                const data = await fetchSupabase('agente_uxi_portal?select=id&limit=1');
                
                console.log('Conexi√≥n exitosa!');
                showStatus('‚úÖ Conectado', false);
                showMessage('‚úÖ Conexi√≥n exitosa a Supabase', false);
                document.getElementById('dashboard-content').style.display = 'block';
                await loadData();
                
            } catch (error) {
                console.error('Error completo:', error);
                showStatus('‚ùå Error de conexi√≥n', true);
                
                showMessage(`
                    <strong>Error al conectar:</strong><br>
                    ${error.message}<br><br>
                    <strong>Verifica:</strong><br>
                    1. La URL es correcta: ${supabaseUrl}<br>
                    2. La clave anon es correcta<br>
                    3. Row Level Security est√° configurado con pol√≠tica de lectura p√∫blica<br>
                    4. La tabla 'agente_uxi_portal' existe
                `, true);
            }
        }

        async function loadData() {
            if (!supabaseUrl || !supabaseKey) return;

            document.getElementById('loading').style.display = 'block';

            try {
                let query = 'agente_uxi_portal?select=id,session_id,message,user_email,rating,created_at,created_at_chile:created_at&order=created_at.desc';

                // Apply filters
                const period = document.getElementById('period-filter').value;
                const dateFrom = document.getElementById('date-from').value;
                const dateTo = document.getElementById('date-to').value;

                if (period === 'today') {
                    const today = new Date().toISOString().split('T')[0];
                    query += `&created_at=gte.${today}`;
                } else if (period === 'week') {
                    const weekAgo = new Date();
                    weekAgo.setDate(weekAgo.getDate() - 7);
                    query += `&created_at=gte.${weekAgo.toISOString()}`;
                } else if (period === 'month') {
                    const monthAgo = new Date();
                    monthAgo.setMonth(monthAgo.getMonth() - 1);
                    query += `&created_at=gte.${monthAgo.toISOString()}`;
                }

                if (dateFrom) {
                    query += `&created_at=gte.${dateFrom}T00:00:00`;
                }
                if (dateTo) {
                    const endDate = new Date(dateTo);
                    endDate.setDate(endDate.getDate() + 1);
                    query += `&created_at=lt.${endDate.toISOString()}`;
                }

                const data = await fetchSupabase(query);
                
                // Convertir created_at de UTC a Chile manualmente
                data.forEach(item => {
                    if (item.created_at) {
                        // Crear fecha UTC y aplicar offset de Chile (UTC-3 en verano, UTC-4 en invierno)
                        const utcDate = new Date(item.created_at);
                        // PostgreSQL devuelve UTC, restar 3 horas para Chile (verano)
                        // La zona horaria America/Santiago maneja autom√°ticamente el horario de verano
                        const chileOffset = -3 * 60; // UTC-3 en minutos
                        const localOffset = utcDate.getTimezoneOffset(); // Offset del navegador
                        const totalOffset = chileOffset - localOffset;
                        
                        const chileDate = new Date(utcDate.getTime() + totalOffset * 60000);
                        item.created_at_local = chileDate;
                    }
                });
                
                allData = data;
                updateDashboard(data);
                console.log('Datos cargados:', data.length, 'registros');
                
            } catch (error) {
                showMessage('Error al cargar datos: ' + error.message, true);
                console.error('Error:', error);
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }

        function updateDashboard(data) {
            // Reset pagination
            currentPage = 1;
            
            // Update stats
            document.getElementById('total-conversations').textContent = data.length;
            
            const uniqueSessions = new Set(data.map(d => d.session_id)).size;
            document.getElementById('total-sessions').textContent = uniqueSessions;

            // Calculate ratings
            const ratingsData = data.filter(d => d.rating !== null && d.rating !== undefined);
            const totalRatings = ratingsData.length;
            document.getElementById('total-ratings').textContent = totalRatings;
            
            if (totalRatings > 0) {
                const avgRating = (ratingsData.reduce((sum, d) => sum + d.rating, 0) / totalRatings).toFixed(1);
                document.getElementById('avg-rating').textContent = avgRating + ' ‚≠ê';
            } else {
                document.getElementById('avg-rating').textContent = '-';
            }

            // Update charts
            updateDailyChart(data);
            updateHourlyChart(data);
            updateRatingsChart(data);
            updateRatingsTimeChart(data);
            updateSessionsChart(data);
            updateTable(data);
        }

        function updateDailyChart(data) {
            const dailyData = {};
            data.forEach(item => {
                const date = item.created_at.split('T')[0];
                dailyData[date] = (dailyData[date] || 0) + 1;
            });

            const sortedDates = Object.keys(dailyData).sort();
            const counts = sortedDates.map(date => dailyData[date]);

            if (charts.daily) charts.daily.destroy();

            const ctx = document.getElementById('dailyChart').getContext('2d');
            charts.daily = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: sortedDates,
                    datasets: [{
                        label: 'Conversaciones',
                        data: counts,
                        borderColor: '#1a237e',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        function updateHourlyChart(data) {
            const hourlyData = new Array(24).fill(0);
            data.forEach(item => {
                const hour = new Date(item.created_at).getHours();
                hourlyData[hour]++;
            });

            if (charts.hourly) charts.hourly.destroy();

            const ctx = document.getElementById('hourlyChart').getContext('2d');
            charts.hourly = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Array.from({length: 24}, (_, i) => `${i}:00`),
                    datasets: [{
                        label: 'Conversaciones',
                        data: hourlyData,
                        backgroundColor: 'rgba(102, 126, 234, 0.8)',
                        borderColor: '#1a237e',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        function updateSessionsChart(data) {
            const sessionCounts = {};
            data.forEach(item => {
                sessionCounts[item.session_id] = (sessionCounts[item.session_id] || 0) + 1;
            });

            const sortedSessions = Object.entries(sessionCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);

            if (charts.sessions) {
                charts.sessions.destroy();
                charts.sessions = null;
            }

            const ctx = document.getElementById('sessionsChart').getContext('2d');
            charts.sessions = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedSessions.map(s => s[0].substring(0, 20) + '...'),
                    datasets: [{
                        label: 'Mensajes',
                        data: sortedSessions.map(s => s[1]),
                        backgroundColor: 'rgba(118, 75, 162, 0.8)',
                        borderColor: '#0d47a1',
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        function updateRatingsChart(data) {
            // Contar ratings del 1 al 5
            const ratingCounts = {1: 0, 2: 0, 3: 0, 4: 0, 5: 0};
            data.forEach(item => {
                if (item.rating >= 1 && item.rating <= 5) {
                    ratingCounts[item.rating]++;
                }
            });

            if (charts.ratings) {
                charts.ratings.destroy();
                charts.ratings = null;
            }

            const ctx = document.getElementById('ratingsChart').getContext('2d');
            charts.ratings = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['‚≠ê 1', '‚≠ê‚≠ê 2', '‚≠ê‚≠ê‚≠ê 3', '‚≠ê‚≠ê‚≠ê‚≠ê 4', '‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê 5'],
                    datasets: [{
                        label: 'Cantidad',
                        data: [ratingCounts[1], ratingCounts[2], ratingCounts[3], ratingCounts[4], ratingCounts[5]],
                        backgroundColor: [
                            'rgba(239, 68, 68, 0.8)',
                            'rgba(249, 115, 22, 0.8)',
                            'rgba(234, 179, 8, 0.8)',
                            'rgba(34, 197, 94, 0.8)',
                            'rgba(16, 185, 129, 0.8)'
                        ],
                        borderColor: [
                            '#ef4444',
                            '#f97316',
                            '#eab308',
                            '#22c55e',
                            '#10b981'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        function updateRatingsTimeChart(data) {
            // Agrupar ratings por d√≠a
            const dailyRatings = {};
            data.forEach(item => {
                if (item.rating >= 1 && item.rating <= 5) {
                    const date = item.created_at.split('T')[0];
                    if (!dailyRatings[date]) {
                        dailyRatings[date] = [];
                    }
                    dailyRatings[date].push(item.rating);
                }
            });

            const sortedDates = Object.keys(dailyRatings).sort();
            const avgRatings = sortedDates.map(date => {
                const ratings = dailyRatings[date];
                return (ratings.reduce((a, b) => a + b, 0) / ratings.length).toFixed(1);
            });

            if (charts.ratingsTime) {
                charts.ratingsTime.destroy();
                charts.ratingsTime = null;
            }

            const ctx = document.getElementById('ratingsTimeChart').getContext('2d');
            charts.ratingsTime = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: sortedDates,
                    datasets: [{
                        label: 'Rating Promedio',
                        data: avgRatings,
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 5,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        function updateTable(data) {
            const tbody = document.getElementById('table-body');
            tbody.innerHTML = '';

            if (!data || data.length === 0) {
                const row = tbody.insertRow();
                row.innerHTML = '<td colspan="5" style="text-align: center; padding: 20px;">No hay conversaciones para mostrar</td>';
                document.getElementById('prev-btn').disabled = true;
                document.getElementById('next-btn').disabled = true;
                return;
            }

            // Calcular paginaci√≥n
            const totalPages = Math.ceil(data.length / rowsPerPage);
            const startIndex = (currentPage - 1) * rowsPerPage;
            const endIndex = startIndex + rowsPerPage;
            const pageData = data.slice(startIndex, endIndex);

            // Actualizar informaci√≥n de p√°gina
            document.getElementById('page-info').textContent = `P√°gina ${currentPage} de ${totalPages} (${data.length} total)`;
            
            // Habilitar/deshabilitar botones
            document.getElementById('prev-btn').disabled = currentPage === 1;
            document.getElementById('next-btn').disabled = currentPage === totalPages;

            // Renderizar filas
            pageData.forEach(item => {
                const row = tbody.insertRow();
                
                let dateChile = 'N/A';
                try {
                    const utcDate = new Date(item.created_at);
                    // NOTA: La base de datos guarda en hora Chile (no en UTC)
                    // Por lo tanto NO necesitamos restar 3 horas
                    const chileDate = utcDate;
                    
                    // Formatear en formato legible
                    const day = String(chileDate.getUTCDate()).padStart(2, '0');
                    const month = String(chileDate.getUTCMonth() + 1).padStart(2, '0');
                    const year = chileDate.getUTCFullYear();
                    const hours = String(chileDate.getUTCHours()).padStart(2, '0');
                    const minutes = String(chileDate.getUTCMinutes()).padStart(2, '0');
                    const seconds = String(chileDate.getUTCSeconds()).padStart(2, '0');
                    
                    dateChile = `${day}-${month}-${year}, ${hours}:${minutes}:${seconds}`;
                    
                } catch (e) {
                    console.error('Error formateando fecha:', e);
                    dateChile = item.created_at;
                }

                let messagePreview = 'Sin mensaje';
                try {
                    if (item.message) {
                        const msg = typeof item.message === 'string' ? JSON.parse(item.message) : item.message;
                        messagePreview = msg.content || msg.text || JSON.stringify(msg).substring(0, 50);
                    }
                } catch (e) {
                    messagePreview = String(item.message || '').substring(0, 50);
                }

                const email = item.user_email || '-';
                const rating = item.rating ? '‚≠ê'.repeat(item.rating) + ` (${item.rating})` : '-';

                row.innerHTML = `
                    <td>${item.id || 'N/A'}</td>
                    <td>${email}</td>
                    <td>${dateChile}</td>
                    <td class="message-preview" title="${messagePreview}">${messagePreview}</td>
                    <td style="text-align: center;">${rating}</td>
                `;
            });
        }

        function nextPage() {
            const totalPages = Math.ceil(allData.length / rowsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                updateTable(allData);
            }
        }

        function previousPage() {
            if (currentPage > 1) {
                currentPage--;
                updateTable(allData);
            }
        }

        function downloadCSV() {
            if (!allData || allData.length === 0) {
                showMessage('No hay datos para descargar', true);
                return;
            }

            // Crear CSV
            let csv = 'ID,Email,Session ID,Fecha y Hora (Chile),Mensaje,Rating\n';
            
            allData.forEach(item => {
                let dateChile = 'N/A';
                try {
                    const utcDate = new Date(item.created_at);
                    // La base de datos guarda en hora Chile (no UTC)
                    const chileDate = utcDate;
                    
                    const day = String(chileDate.getUTCDate()).padStart(2, '0');
                    const month = String(chileDate.getUTCMonth() + 1).padStart(2, '0');
                    const year = chileDate.getUTCFullYear();
                    const hours = String(chileDate.getUTCHours()).padStart(2, '0');
                    const minutes = String(chileDate.getUTCMinutes()).padStart(2, '0');
                    const seconds = String(chileDate.getUTCSeconds()).padStart(2, '0');
                    
                    dateChile = `${day}-${month}-${year} ${hours}:${minutes}:${seconds}`;
                } catch (e) {
                    console.error('Error formateando fecha:', e);
                    dateChile = item.created_at;
                }

                let messageText = '';
                try {
                    if (item.message) {
                        const msg = typeof item.message === 'string' ? JSON.parse(item.message) : item.message;
                        messageText = msg.content || msg.text || JSON.stringify(msg);
                        // Escapar comillas y saltos de l√≠nea para CSV
                        messageText = messageText.replace(/"/g, '""').replace(/\n/g, ' ');
                    }
                } catch (e) {
                    messageText = String(item.message || '');
                }

                const email = item.user_email || '';
                const rating = item.rating || '';

                csv += `${item.id},"${email}","${item.session_id}","${dateChile}","${messageText}",${rating}\n`;
            });

            // Crear archivo y descargarlo
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            const now = new Date();
            const filename = `conversaciones_chatbot_${now.getFullYear()}-${(now.getMonth()+1).toString().padStart(2,'0')}-${now.getDate().toString().padStart(2,'0')}.csv`;
            
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            showMessage(`‚úÖ Descargado: ${filename} (${allData.length} registros)`, false);
        }

        // Set default date range
        const today = new Date();
        const weekAgo = new Date();
        weekAgo.setDate(weekAgo.getDate() - 7);
        document.getElementById('date-to').value = today.toISOString().split('T')[0];
        document.getElementById('date-from').value = weekAgo.toISOString().split('T')[0];
    </script>
</body>
</html>
